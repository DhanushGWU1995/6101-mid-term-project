---
title: "What factors are significantly associated with coronary heart disease diagnosis?"
author: " "
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r init, include=FALSE}
library(ezids)
knitr::opts_chunk$set(warning = F, message = F)
options(scientific=T, digits = 3) 
```

# Abstract

This study examines key factors associated with coronary heart disease using simple statistical analysis. We investigate 5 main research questions using t-tests, chi-square tests, and ANOVA to understand the relationship between lifestyle factors, health metrics, and coronary heart disease diagnosis.

**Research Questions:**
1. Is there a significant difference in BMI between people with and without coronary heart disease? (T-test)
2. Is smoking status associated with coronary heart disease? (Chi-square test)
3. Does BMI vary significantly across different general health status levels? (ANOVA)
4. Does exercise participation vary significantly across different BMI categories, suggesting a role in weight management? (Chi-square test)
5. Is diabetes status associated with coronary heart disease? (Chi-square test)

# Data Loading
```{r}
Heart_data <- data.frame(read.csv("BRFSS_2024_Readable_Columns.csv"))
str(Heart_data)
summary(Heart_data)
```
# Confirm missing value ratio
```{r}
cat("=== MISSING VALUE ANALYSIS FOR STATISTICAL DECISION MAKING ===\n")

# Check missing percentages for all variables to make informed decisions
missing_analysis <- data.frame(
  Variable = names(Heart_data),
  Missing_Count = sapply(Heart_data, function(x) sum(is.na(x))),
  Missing_Percent = sapply(Heart_data, function(x) round((sum(is.na(x)) / length(x)) * 100, 2))
)

# Sort by missing percentage
missing_analysis <- missing_analysis[order(-missing_analysis$Missing_Percent), ]
print(missing_analysis)

# Focus on the four continuous variables
continuous_vars <- c("BMI_Category", "Exercise_Past_30_Days", "Mental_Health_Days", "Poor_Physical_Health_Days")

cat("\n=== CONTINUOUS VARIABLES MISSING VALUE RATES ===\n")
for(var in continuous_vars) {
  if(var %in% names(Heart_data)) {
    missing_count <- sum(is.na(Heart_data[[var]]))
    missing_pct <- (missing_count / nrow(Heart_data)) * 100
    cat(sprintf("• %s: %d missing (%.1f%%)\n", var, missing_count, missing_pct))
  }
}

# Categorize variables by missing percentage for appropriate handling
high_missing <- missing_analysis$Variable[missing_analysis$Missing_Percent > 50]
moderate_missing <- missing_analysis$Variable[missing_analysis$Missing_Percent >= 5 & missing_analysis$Missing_Percent <= 50]
low_missing <- missing_analysis$Variable[missing_analysis$Missing_Percent < 5]

cat("\nVariables categorized by missing percentage:\n")
cat("HIGH (>50% missing - should DROP):", paste(high_missing, collapse = ", "), "\n")
cat("MODERATE (5-50% missing - consider imputation):", paste(moderate_missing, collapse = ", "), "\n") 
cat("LOW (<5% missing - complete case analysis):", paste(low_missing, collapse = ", "), "\n")
```

# Data Transformation
```{r}
# Transform all variables that exist in the dataset for potential analysis

# Age groups
Heart_data$Age_Group_5yr <- factor(
  Heart_data$Age_Group_5yr,
  levels = 1:13,
  labels = c(
    "18-24", "25-29", "30-34", "35-39", "40-44", 
    "45-49", "50-54", "55-59", "60-64", "65-69", 
    "70-74", "75-79", "80+")
)

# Demographics
Heart_data$Sex <- factor(
  Heart_data$Sex,
  levels = c(1, 2),
  labels = c("Male", "Female")
)

# Health conditions
Heart_data$Diabetes_Status <- factor(
  Heart_data$Diabetes_Status,
  levels = c(1, 2, 3, 4),
  labels = c("Yes", "Yes/borderline", "Yes/pregnancy only", "No")
)

# Smoking variables
Heart_data$Smoking_Status <- factor(
  Heart_data$Smoked_100_Cigarettes_Lifetime,
  levels = c(1, 2),
  labels = c("Yes", "No")
)

# BMI_Category_Alt 
Heart_data$BMI_Category_Alt  <- factor(
  Heart_data$BMI_Category_Alt ,
  levels = c(1, 2, 3, 4),
  labels = c("Underweight", "Normal Weight", "Overweight", "Obese")
)

# Exercise variables
Heart_data$Exercise_Past_30_Days <- factor(
  Heart_data$Exercise_Past_30_Days,
  levels = c(1, 2),
  labels = c("Yes", "No")
)

# Cardiovascular history
Heart_data$CVD_Stroke_History <- factor(
  Heart_data$CVD_Stroke_History,
  levels = c(1, 2),
  labels = c("Yes", "No")
)

Heart_data$Coronary_Heart_Disease <- factor(
  Heart_data$Coronary_Heart_Disease,
  levels = c(1, 2),
  labels = c("Yes", "No")
)

Heart_data$Heart_Attack_History <- factor(
  Heart_data$Heart_Attack_History,
  levels = c(1, 2),
  labels = c("Yes", "No")
)

# General health
Heart_data$General_Health_Status <- factor(
  Heart_data$General_Health_Status,
  levels = c(1, 2, 3, 4, 5),
  labels = c("Excellent", "Very Good", "Good", "Fair", "Poor")
)

# BMI transformation (convert from coded value to actual BMI)
Heart_data$BMI_Value <- Heart_data$BMI_Category / 100

# Additional variables that exist in dataset
if("Flu_Vaccination" %in% names(Heart_data)) {
  Heart_data$Flu_Vaccination <- factor(
    Heart_data$Flu_Vaccination,
    levels = c(1, 2),
    labels = c("Yes", "No")
  )
}

if("Difficulty_Walking_Stairs" %in% names(Heart_data)) {
  Heart_data$Difficulty_Walking_Stairs <- factor(
    Heart_data$Difficulty_Walking_Stairs,
    levels = c(1, 2),
    labels = c("Yes", "No")
  )
}

str(Heart_data)
summary(Heart_data)
```

# Data Cleaning

## Statistically Sound Missing Value Handling

```{r}
cat("=== APPLYING EVIDENCE-BASED MISSING VALUE TREATMENT ===\n")

# Step 1: Drop variables with >50% missing (statistically unreliable)
Heart_clean <- Heart_data

# Check which variables have >50% missing and should be dropped
high_missing_vars <- c()
for(var in names(Heart_clean)) {
  missing_pct <- (sum(is.na(Heart_clean[[var]])) / nrow(Heart_clean)) * 100
  if(missing_pct > 50) {
    high_missing_vars <- c(high_missing_vars, var)
  }
}

if(length(high_missing_vars) > 0) {
  cat("Dropping variables with >50% missing:", paste(high_missing_vars, collapse = ", "), "\n")
  Heart_clean <- Heart_clean[, !names(Heart_clean) %in% high_missing_vars]
}

# Step 2: Handle continuous variables with 5-20% missing (ONLY these get imputed)
continuous_vars <- c("BMI_Value", "Mental_Health_Days", "Poor_Physical_Health_Days", "Alcohol_Days_Per_Month", "Binge_Drinking_Episodes", "Max_Drinks_Single_Occasion")
available_continuous <- continuous_vars[continuous_vars %in% names(Heart_clean)]

cat("\n=== CONTINUOUS VARIABLE IMPUTATION (5-20% missing only) ===\n")
for(var in available_continuous) {
  missing_count <- sum(is.na(Heart_clean[[var]]))
  missing_pct <- (missing_count / nrow(Heart_clean)) * 100
  
  if(missing_pct >= 5 && missing_pct <= 20) {
    # Use MEDIAN imputation (more robust than mean)
    var_median <- median(Heart_clean[[var]], na.rm = TRUE)
    Heart_clean[[var]][is.na(Heart_clean[[var]])] <- var_median
    cat(sprintf(" %s: Imputed %d values (%.1f%%) with MEDIAN (%.2f)\n", 
                var, missing_count, missing_pct, var_median))
  } else if(missing_pct > 20) {
    cat(sprintf(" %s: %.1f%% missing - Consider advanced imputation or dropping\n", var, missing_pct))
  } else {
    cat(sprintf(" %s: %.1f%% missing - Keeping as NA for complete case analysis\n", var, missing_pct))
  }
}

# Step 3: For categorical variables - NO imputation, use complete case analysis
cat("\n=== CATEGORICAL VARIABLES - NO IMPUTATION ===\n")
categorical_vars <- names(Heart_clean)[sapply(Heart_clean, function(x) is.factor(x) || is.character(x))]
for(var in categorical_vars) {
  missing_count <- sum(is.na(Heart_clean[[var]]))
  missing_pct <- (missing_count / nrow(Heart_clean)) * 100
  if(missing_count > 0) {
    cat(sprintf(" %s: %d missing (%.1f%%) - Will use complete case analysis\n", var, missing_count, missing_pct))
  }
}

# Step 4: Remove rows with missing CRITICAL variables only
critical_vars <- c("Coronary_Heart_Disease", "General_Health_Status", "Sex")
available_critical <- critical_vars[critical_vars %in% names(Heart_clean)]

# Remove invalid General Health Status responses (7=Don't know, 9=Refused) before final cleaning
if("General_Health_Status" %in% names(Heart_clean)) {
  valid_health_responses <- Heart_clean$General_Health_Status %in% c("Excellent", "Very Good", "Good", "Fair", "Poor")
  invalid_health_count <- sum(!valid_health_responses, na.rm = TRUE)
  if(invalid_health_count > 0) {
    cat(sprintf("Removing %d rows with invalid General Health Status responses\n", invalid_health_count))
    Heart_clean <- Heart_clean[valid_health_responses, ]
  }
}

rows_before <- nrow(Heart_clean)
Heart_clean <- Heart_clean[complete.cases(Heart_clean[available_critical]), ]
rows_after <- nrow(Heart_clean)

cat(sprintf("Rows removed due to missing CRITICAL variables: %d\n", rows_before - rows_after))
cat(sprintf("Final dataset: %d rows × %d columns\n", nrow(Heart_clean), ncol(Heart_clean)))
cat(sprintf("Data retention rate: %.1f%%\n", (rows_after / nrow(Heart_data)) * 100))

# Check remaining missing values
remaining_missing <- sapply(Heart_clean, function(x) sum(is.na(x)))
remaining_missing <- remaining_missing[remaining_missing > 0]
if(length(remaining_missing) > 0) {
  cat("\nRemaining missing values (for complete case analysis in specific tests):\n")
  print(remaining_missing)
} else {
  cat("\n No remaining missing values\n")
}

str(Heart_clean)
summary(Heart_clean)
```

## Statistically Appropriate Outlier Treatment (Removing impossible data / Dirty data for average human being)

```{r}
cat("=== OUTLIER ANALYSIS WITH CLINICAL RELEVANCE ===\n")

# Store data before outlier removal for comparison
Heart_before_outlier <- Heart_clean

# Only remove IMPOSSIBLE values, not clinical outliers
if("BMI_Value" %in% names(Heart_clean)) {
  # BMI: Only remove impossible values (<10 or >70 kg/m²)
  bmi_outliers <- which(Heart_clean$BMI_Value < 10 | Heart_clean$BMI_Value > 70)
  if(length(bmi_outliers) > 0) {
    cat(sprintf("Removing %d impossible BMI values (<10 or >70)\n", length(bmi_outliers)))
    Heart_clean <- Heart_clean[-bmi_outliers, ]
  } else {
    cat("All BMI values within plausible human range\n")
  }
}

# Health days: Should be 0-30, but we already handled this in data transformation
# Not removing high values as they may be clinically relevant

# Final data check - remove rows missing ONLY the variables we actually use in our 5 SMART research questions

analysis_vars <- c("BMI_Value", "General_Health_Status", "Coronary_Heart_Disease", 
                   "Sex", "Exercise_Past_30_Days", "Diabetes_Status", "Smoking_Status")
available_analysis_vars <- analysis_vars[analysis_vars %in% names(Heart_clean)]

rows_before_final <- nrow(Heart_clean)
Heart_clean <- Heart_clean[complete.cases(Heart_clean[available_analysis_vars]), ]
rows_after_final <- nrow(Heart_clean)

if(rows_before_final != rows_after_final) {
  cat(sprintf("Removed %d rows missing critical analysis variables\n", rows_before_final - rows_after_final))
} else {
  cat("No additional rows removed - all critical variables complete\n")
}

cat(sprintf("\nFinal cleaned dataset: %d rows × %d columns\n", nrow(Heart_clean), ncol(Heart_clean)))
cat(sprintf("Overall data retention: %.1f%% of original data\n", (nrow(Heart_clean) / nrow(Heart_data)) * 100))

# Validate our approach preserved key relationships by checking if the key variable BMI & Coronary_Heart_Disease are present in the final Dataset
if("BMI_Value" %in% names(Heart_clean) && "Coronary_Heart_Disease" %in% names(Heart_clean)) {
  bmi_by_coronary <- aggregate(BMI_Value ~ Coronary_Heart_Disease, Heart_clean, function(x) c(mean=mean(x), sd=sd(x), n=length(x)))
  cat("\nValidation - BMI by Coronary Heart Disease Status (preserved for analysis):\n")
  print(bmi_by_coronary)
}

str(Heart_clean)
```

# Descriptive Statistics

## Summary
```{r}
summary(Heart_clean)
```

## Structure
```{r}
str(Heart_clean)
```

## Data Visualizations
```{r}
library(ggplot2)

#Coronary_Heart_Disease
ggplot(Heart_clean, aes(x = Coronary_Heart_Disease)) +
  geom_bar(fill = "navy") +
  labs(title = "Distribution of Coronary Heart Disease",
       x = "Coronary Heart Disease", y = "Count")

# Diabetes Status
ggplot(Heart_clean, aes(x = Diabetes_Status)) +
  geom_bar(fill = "forestgreen") +
  labs(title = "Distribution of Diabetes Status",
       x = "Diabetes Status", y = "Count")


# Smoking Status
ggplot(Heart_clean, aes(x = Smoking_Status)) +
  geom_bar(fill = "red") +
  labs(title = "Distribution of Smoking Status",
       x = "Smoking Status", y = "Count")

#General_Health_Status
ggplot(Heart_clean, aes(x = General_Health_Status)) +
  geom_bar(fill = "blue") +
  labs(title = "Distribution of General Health Status",
       x = "General Health Status", y = "Count")

#Exercise_Past_30_Days 
ggplot(Heart_clean, aes(x = Exercise_Past_30_Days)) +
  geom_bar(fill = "purple") +
  labs(title = "Distribution Exercise Past 30 Days",
       x = "Exercise Past 30 Days", y = "Count")

#BMI_Category
ggplot(Heart_clean, aes(x = BMI_Category_Alt)) +
  geom_bar(fill = "orange") +
  labs(title = "Distribution BMI_Category",
       x = "BMI Category", y = "Count")

# BMI_Value
ggplot(na.omit(Heart_clean), aes(x = BMI_Value)) +
  geom_histogram(binwidth = 2, fill = "skyblue", color = "black") +
  labs(title = "Distribution of BMI",
       x = "BMI_Value", y = "Count")
```

From the chart of Coronary Heart Disease, we can see that most of the samples do not have this condition.

From the chart of Diabetes Status, we can see that most of the samples have some form of diabetes, especially those related to pregnancy.

From the chart of Smoking Status, we can see that the number of non-smokers is slightly higher than that of smokers.

From the chart of General Health Status, we can see that most of the samples are in good health, while the proportion of those with poor health is the smallest.

From the chart of Exercise in the Past 30 Days, we can see that most of the samples have exercised within the past 30 days.

From the chart of BMI Category (Alt), we can see that most of the samples fall within the normal and obese BMI ranges.

From the chart of BMI Value, we can see that the distribution is right-skewed, with most of the data concentrated in the 20–40 range.

# Data Analysis
```{r}
# Q1:Is there a significant difference in BMI between people with and without coronary heart disease? (T-test)
t_test_BMI_coronary <- t.test(BMI_Value ~ Coronary_Heart_Disease, data = Heart_data)
t_test_BMI_coronary

# Q2: Is smoking status associated with coronary heart disease? (Chi-square test)
chisq.test(table(Heart_data$Smoking_Status,
                 Heart_data$Coronary_Heart_Disease, useNA = "no"))

# Q3: Does BMI vary significantly across different general health status levels? (ANOVA)
anova_result <- aov(BMI_Value ~ General_Health_Status, data = Heart_data)
summary(anova_result)

# Q4: Does exercise participation vary significantly across different BMI categories, suggesting a role in weight management? (Chi-square test)
chisq.test(table(Heart_data$Exercise_Past_30_Days,
                 Heart_data$BMI_Category_Alt, useNA = "no"))

# Q5: Is diabetes status associated with coronary heart disease? (Chi-square test)
chisq.test(table(Heart_data$Diabetes_Status, 
                 Heart_data$Coronary_Heart_Disease,useNA = "no"))

```
For Q1, the t-test shows a very strong difference in BMI between people with and without coronary heart disease (p < 2e-16). This means it is almost impossible that the result happened by chance, suggesting that individuals with coronary heart disease tend to have higher BMI on average.

For Q2, the chi-squared test shows a very strong relationship between smoking status and coronary heart disease (p < 2e-16). This means it is almost impossible that the result happened by chance, suggesting that smokers are much more likely to have coronary heart disease than non-smokers.

For Q3, the ANOVA test shows a very strong difference in BMI across different general health status levels (p < 2e-16). This means it is almost impossible that the result happened by chance, suggesting that BMI varies significantly depending on an individual’s reported health condition.

For Q4, the chi-squared test shows a very strong relationship between past-30-day exercise participation and BMI category (p < 2e-16). This means it is almost impossible that the result happened by chance. People who reported exercising in the past 30 days tend to fall into lower BMI categories, while those who did not exercise are more likely to be in higher BMI groups. This pattern suggests that regular physical activity plays an important role in weight management and maintaining a healthier BMI.

For Q5, the chi-squared test shows a very strong relationship between diabetes status and coronary heart disease (p < 2e-16). This means it is almost impossible that the result happened by chance. People with diabetes or prediabetes have a much higher likelihood of developing coronary heart disease compared to those without diabetes, suggesting that poor blood sugar control is closely linked to increased heart disease risk.

# Conclusion
